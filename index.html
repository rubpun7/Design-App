<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Design Nuch Potchaman - Pro Edition</title>    
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 10px; background: #f0f0f0; touch-action: manipulation; }
        .container { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 1000px; margin: auto; display: flex; flex-direction: column; gap: 10px; }
        .main-layout { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        
            /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà Canvas ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏π‡∏° */
            /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å */
        .canvas-area { 
            flex: 2; 
            min-width: 300px; 
            height: 60vh; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô */
            overflow: auto; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡πÅ‡∏ñ‡∏ö‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏π‡∏° */
            background: #ccc; 
            border: 2px solid #ddd; 
            border-radius: 8px; 
            position: relative;
        }

        /* ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        .canvas-area.move-mode canvas { pointer-events: none; }

        #canvasWrapper { position: relative; transform-origin: 0 0; margin: auto; }
        canvas { 
            display: block; 
            background: white; 
            touch-action: none; 
            transform-origin: 0 0; /* ‡∏ã‡∏π‡∏°‡∏à‡∏≤‡∏Å‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô */
            box-shadow: 0 0 30px rgba(0,0,0,0.2); //‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å 15px ‡πÄ‡∏õ‡πá‡∏ô 30px
            }
        
        .controls { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 10px; }
        .btn { padding: 10px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; color: white; font-size: 12px; }
        .btn-blue { background: #3498db; }
        .btn-yellow { background: #f1c40f; color: #333; }
        .btn-green { background: #27ae60; }
        .btn-red { background: #e74c3c; }
        .btn-purple { background: #9b59b6; }

        /* Sidebar & Popups */
        .sidebar { 
            flex: 1; min-width: 250px; background: #fff; border: 1px solid #ddd; 
            border-radius: 8px; padding: 15px; display: none; position: relative;
        }
        .sidebar.active { display: block; }
        .close-sidebar { position: absolute; right: 10px; top: 10px; cursor: pointer; font-weight: bold; color: red; }

        /* Palette 20 Colors */
        .palette-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-top: 10px; }
        .swatch { width: 100%; aspect-ratio: 1/1; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; }
        .swatch.selected { border: 2px solid #000; transform: scale(1.1); }

        .layer-item { display: flex; align-items: center; justify-content: space-between; padding: 10px; border-bottom: 1px solid #eee; }
        .cat-tabs { display: flex; gap: 5px; margin-bottom: 10px; border-bottom: 1px solid #ddd; }
        .tab-btn { padding: 8px 12px; cursor: pointer; border: none; background: #eee; border-radius: 5px 5px 0 0; }
        .tab-btn.active { background: #3498db; color: white; }
        .preset-group { display: none; }
        .preset-group.active { display: block; }
        .preset-btn { background: #eee; border: 1px solid #ccc; padding: 8px; margin: 4px 0; width: 100%; text-align: left; border-radius: 4px; font-size: 12px; }

        #refImagePreview { max-width: 100%; height: auto; margin-top: 10px; border: 1px solid #ddd; display: block; }

        /* Floating Action Button (FAB) */
        .fab-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column-reverse;
            align-items: center;
            gap: 10px;
            z-index: 9999;
        }

        .fab-main {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #3498db;
            color: white;
            border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }

        .fab-container.active .fab-main { 
            transform: rotate(45deg); background: #e74c3c; 
        }

        .fab-menu {
            display: none;
            flex-direction: column-reverse;
            gap: 10px;
            transition: all 0.3s;
        }

        .fab-container.active .fab-menu { display: flex; }

        .fab-item {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            line-height: 1.2;
            padding: 5px;
        }

        .fab-item-paint { 
            background: #f1c40f; color: #333; 
        }

        .fab-item-palette { 
            background: #9b59b6; 
        }

        /* ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° Undo ‡πÉ‡∏ô FAB */
        .fab-item-undo { 
            background: #f1c40f; color: #333; 
        }

        /* ‡∏™‡∏µ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏ô FAB */
        .fab-item-layer { 
        background: #3498db; 
        }

        .fab-item-template { 
        background: #3498db; 
        }

        .fab-item-save { 
        background: #27ae60; 
        }

        .fab-item-reset { 
        background: #e74c3c; 
        }

    </style>
</head>
<body>

<div class="container">
    <h2>Design Nuch Potchaman Pro</h2>
    
    <div class="controls">
        <button class="btn btn-blue" onclick="toggleSidebar('layers')">Layers List</button>
        <button class="btn btn-blue" onclick="toggleSidebar('presets')">Templates</button>
        <button class="btn btn-purple" onclick="toggleSidebar('colors')">Palette (20)</button>
        <button id="moveModeBtn" class="btn btn-yellow" onclick="toggleMoveMode()">Mode: Paint</button>
        <button class="btn btn-yellow" onclick="undo()">Undo</button>
        <button class="btn btn-green" onclick="saveImage()">Save + Watermark</button>
        <button class="btn btn-red" onclick="resetAll()">Reset All</button>
    </div>

    <div class="tool-box">

        <div class="sidebar active" style="flex: 0.5; min-width: 200px;">
            <strong>Reference Image</strong>
            <input type="file" id="refLoader" accept="image/*" style="font-size:10px; width:100%;">
            <img id="refImagePreview" src="" alt="No Reference Loaded" onerror="this.style.display='none'">
            <textarea id="refNote" placeholder="Write notes here..." style="width:100%; height:80px; margin-top:10px; font-size:12px;"></textarea>
            <div style="margin-top:10px;">
                <strong>Zoom:</strong>
                <input type="range" id="zoomSlider" min="0.1" max="4" step="0.1" value="1" oninput="applyZoom()" style="width:100%;">
                <input type="text" id="fileName" value="Design" style="width:100%; margin-top:5px; padding:5px;" placeholder="File Name">
            </div>
        </div>

    </div>

    <div class="main-layout">
        <div id="sidebarLayers" class="sidebar">
            <span class="close-sidebar" onclick="toggleSidebar('layers')">[ X ]</span>
            <strong>Layer Management</strong>
            <div id="layerList"></div>
            <hr>
            <input type="file" id="imageLoader" accept="image/*" style="display:none;">
            <button class="btn btn-blue" style="width:100%" onclick="document.getElementById('imageLoader').click()">+ Upload Custom Layer</button>
            <button class="btn btn-yellow" style="width:100%; margin-top:10px;" onclick="centerContent()">Center View</button>
        </div>

        <div id="sidebarPresets" class="sidebar">
            <span class="close-sidebar" onclick="toggleSidebar('presets')">[ X ]</span>
            <div class="cat-tabs">
                <button class="tab-btn active" onclick="showTab('‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏∏‡∏¢')">‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏∏‡∏¢</button>
                <button class="tab-btn" onclick="showTab('‡πÅ‡∏Ç‡∏ô')">‡πÅ‡∏Ç‡∏ô</button>
                <button class="tab-btn" onclick="showTab('‡∏´‡∏°‡∏ß‡∏Å')">‡∏´‡∏°‡∏ß‡∏Å</button>
            </div>

            <div id="‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏∏‡∏¢" class="preset-group active">
                <button class="preset-btn" onclick="addPreset('Original', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡πÄ‡∏™‡∏∑‡πâ‡∏≠/Original.png')">‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ê‡∏≤‡∏ô</button>
                <button class="preset-btn" onclick="addPreset('Origin +1', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡πÄ‡∏™‡∏∑‡πâ‡∏≠/Origin +1.png')">‡∏°‡∏≤‡∏ï‡∏£‡∏≤‡∏ê‡∏≤‡∏ô +1</button>
                <button class="preset-btn" onclick="addPreset('Switch BS', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡πÄ‡∏™‡∏∑‡πâ‡∏≠/Switch BS.png')">‡∏™‡∏•‡∏±‡∏ö‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏•‡πá‡∏Å</button>
                <button class="preset-btn" onclick="addPreset('2 Lines', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡πÄ‡∏™‡∏∑‡πâ‡∏≠/2 Lines.png')">2 ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏ó‡πà‡∏≤</button>
                <button class="preset-btn" onclick="addPreset('3 Lines', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡πÄ‡∏™‡∏∑‡πâ‡∏≠/3 Lines.png')">3 ‡πÅ‡∏ñ‡∏ö‡πÄ‡∏ó‡πà‡∏≤</button>
            </div>
            <div id="‡πÅ‡∏Ç‡∏ô" class="preset-group">
                <button class="preset-btn" onclick="addPreset('Chevron 1', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡πÄ‡∏™‡∏∑‡πâ‡∏≠/Chevrons/Chevron 1.png')">‡πÅ‡∏ñ‡∏ö‡πÅ‡∏Ç‡∏ô 1</button>
                <button class="preset-btn" onclick="addPreset('Chevron 2', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡πÄ‡∏™‡∏∑‡πâ‡∏≠/Chevrons/Chevron 2.png')">‡πÅ‡∏ñ‡∏ö‡πÅ‡∏Ç‡∏ô 2</button>
                <button class="preset-btn" onclick="addPreset('Chevron 3', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡πÄ‡∏™‡∏∑‡πâ‡∏≠/Chevrons/Chevron 3.png')">‡πÅ‡∏ñ‡∏ö‡πÅ‡∏Ç‡∏ô 3</button>
            </div>
            <div id="‡∏´‡∏°‡∏ß‡∏Å" class="preset-group">
                <button class="preset-btn" onclick="addPreset('Cap', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡∏´‡∏°‡∏ß‡∏Å/Cap.png')">‡∏´‡∏°‡∏ß‡∏Å‡πÄ‡∏õ‡∏•‡πà‡∏≤</button>
                <button class="preset-btn" onclick="addPreset('Hat Piping', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡∏´‡∏°‡∏ß‡∏Å/Hat Piping.png')">‡πÅ‡∏ñ‡∏ö‡∏ú‡πâ‡∏≤‡∏´‡∏°‡∏ß‡∏Å</button>
                <button class="preset-btn" onclick="addPreset('Ribbon 1', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡∏´‡∏°‡∏ß‡∏Å/Ribbon 1.png')">‡∏£‡∏¥‡∏ö‡∏ö‡∏¥‡πâ‡∏ô 1</button>
                <button class="preset-btn" onclick="addPreset('Ribbon 2', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡∏´‡∏°‡∏ß‡∏Å/Ribbon 2.png')">‡∏£‡∏¥‡∏ö‡∏ö‡∏¥‡πâ‡∏ô 2</button>
                <button class="preset-btn" onclick="addPreset('Ribbon 3', '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/‡∏´‡∏°‡∏ß‡∏Å/Ribbon 3.png')">‡∏£‡∏¥‡∏ö‡∏ö‡∏¥‡πâ‡∏ô 3</button>
            </div>
        </div>

        <div id="sidebarColors" class="sidebar">
            <span class="close-sidebar" onclick="toggleSidebar('colors')">[ X ]</span>
            <strong>Color Shortcuts</strong><br>
            <input type="color" id="colorPicker" value="#ff0000" style="width:100%; height:40px; margin-top:10px;">
            <button class="btn btn-green" style="width:100%; margin-top:5px;" onclick="saveToPalette()">Save current color to slot</button>
            <div class="palette-grid" id="paletteGrid"></div>
        </div>

        <div class="canvas-area" id="scrollArea">
            <div id="canvasWrapper">
                <canvas id="canvas"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    // ‡πÅ‡∏ú‡πà‡∏ô‡πÉ‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå
    const offCanvas = document.createElement('canvas');
    const offCtx = offCanvas.getContext('2d', { willReadFrequently: true });

    // ‡πÅ‡∏ú‡πà‡∏ô‡πÉ‡∏™‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏µ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏≤‡∏¢ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏™‡∏µ‡∏´‡∏≤‡∏¢)
    const colorCanvas = document.createElement('canvas');
    const colorCtx = colorCanvas.getContext('2d', { willReadFrequently: true });
    const watermarkUrl = '‡πÅ‡∏ö‡∏ö‡∏ä‡∏∏‡∏î‡∏Ñ‡∏£‡∏∏‡∏¢/watermark.png';

    let layers = []; 
    let history = [];
    let currentZoom = 1;
    let isMoveMode = false;
    let selectedPaletteIndex = 0;

    // ‡∏£‡∏∞‡∏ö‡∏ö Auto-Save ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
        window.onload = () => {
            const lastSession = localStorage.getItem('nuchDesign_backup');
            if(lastSession) {
                const img = new Image();
                img.onload = () => {
                    canvas.width = img.width; 
                    canvas.height = img.height;
                    offCanvas.width = img.width; 
                    offCanvas.height = img.height;
                    colorCanvas.width = img.width; 
                    colorCanvas.height = img.height;
                
                    ctx.drawImage(img, 0, 0);
                    offCtx.drawImage(img, 0, 0);
                
                    fitCanvasToScreen();
                    saveHistory();
                };
                img.src = lastSession;
            } else {
                // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏Ç‡∏ô‡∏≤‡∏î 2481*3508 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                createDefaultBackground();
            }
        };

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏µ 20 ‡∏ä‡πà‡∏≠‡∏á
    const paletteGrid = document.getElementById('paletteGrid');
    let paletteColors = JSON.parse(localStorage.getItem('nuchPalette')) || Array(20).fill('#ffffff');

    function initPalette() {
        paletteGrid.innerHTML = '';
        paletteColors.forEach((color, i) => {
            const div = document.createElement('div');
            div.className = 'swatch' + (i === selectedPaletteIndex ? ' selected' : '');
            div.style.background = color;
            div.onclick = () => {
                selectedPaletteIndex = i;
                document.getElementById('colorPicker').value = color;
                initPalette();
            };
            paletteGrid.appendChild(div);
        });
    }
    initPalette();

    function saveToPalette() {
        const color = document.getElementById('colorPicker').value;
        paletteColors[selectedPaletteIndex] = color;
        localStorage.setItem('nuchPalette', JSON.stringify(paletteColors));
        initPalette();
    }

    // ‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏û / ‡∏•‡∏á‡∏™‡∏µ
    function toggleMoveMode() {
        isMoveMode = !isMoveMode;
        const btn = document.getElementById('moveModeBtn');
        const area = document.getElementById('scrollArea');
        if(isMoveMode) {
            btn.innerText = "Mode: Move (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏†‡∏≤‡∏û)";
            btn.style.background = "#e67e22";
            area.classList.add('move-mode');
        } else {
            btn.innerText = "Mode: Paint (‡∏•‡∏á‡∏™‡∏µ)";
            btn.style.background = "#f1c40f";
            area.classList.remove('move-mode');
        }
    }

    function toggleSidebar(id) {
        const el = document.getElementById('sidebar' + id.charAt(0).toUpperCase() + id.slice(1));
        el.classList.toggle('active');
    }

    function showTab(id) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.preset-group').forEach(g => g.classList.remove('active'));
        event.currentTarget.classList.add('active');
        document.getElementById(id).classList.add('active');
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Reference Image
    document.getElementById('refLoader').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = document.getElementById('refImagePreview');
            img.src = event.target.result;
            img.style.display = 'block';
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Upload Layer ‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å
    document.getElementById('imageLoader').addEventListener('change', (e) => {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => addLayer(img, e.target.files[0].name);
            img.src = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    function fitCanvasToScreen() {
        const area = document.getElementById('scrollArea');
        const baseScale = Math.min((area.clientWidth-40)/canvas.width, (area.clientHeight-40)/canvas.height);
        document.getElementById('zoomSlider').value = baseScale > 1 ? 1 : baseScale;
        applyZoom();
    }

    function applyZoom() {
        currentZoom = parseFloat(document.getElementById('zoomSlider').value);
        const wrapper = document.getElementById('canvasWrapper');
        wrapper.style.width = (canvas.width * currentZoom) + 'px';
        wrapper.style.height = (canvas.height * currentZoom) + 'px';
        canvas.style.transform = `scale(${currentZoom})`;
    }

    function saveHistory() {
        if (history.length > 15) history.shift();
        const data = canvas.toDataURL();
        history.push(data);
        localStorage.setItem('nuchDesign_backup', data);
    }


    function undo() { 
        if (history.length > 1) { 
            history.pop(); 
        const img = new Image(); 
        img.onload = () => { 
            ctx.clearRect( 0 , 0 , canvas.width, canvas.height); 
            ctx.drawImage(img, 0 , 0); 
            offCtx.clearRect( 0 , 0 , offCanvas.width, offCanvas.height); 
            offCtx.drawImage(img, 0, 0); 
            }; 
            img.src = history[history.length-1]; 
        } 
    }
    // --- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏£‡∏¥‡∏á ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠ Canvas ---
function addLayer(img, name) {
    if (layers.length === 0) {
        canvas.width = img.width;
        canvas.height = img.height;
        colorCanvas.width = img.width;
        colorCanvas.height = img.height;
        colorCtx.fillStyle = "white";
        colorCtx.fillRect(0, 0, colorCanvas.width, colorCanvas.height);
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏´‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à
        setTimeout(fitCanvasToScreen, 100);
    }
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° visible: true ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏î‡πâ‡∏ß‡∏¢
    layers.push({ name: name, img: img, visible: true });
    redrawAllLayers();
}

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Layer ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏Ç‡∏ô‡∏≤‡∏î‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô
    function createDefaultBackground() {
        const bgCanvas = document.createElement('canvas');
        bgCanvas.width = 2481;
        bgCanvas.height = 3508;
        const bgCtx = bgCanvas.getContext('2d');
    
        // ‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏•‡∏á‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        bgCtx.fillStyle = "white";
        bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);

        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Layer
        const img = new Image();
        img.onload = () => {
        addLayer(img, "‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß");
        };
        img.src = bgCanvas.toDataURL();
}

    function redrawAllLayers() {
        // 1. ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å
        ctx.clearRect(0, 0, canvas.width, canvas.height);
    
        // 2. ‡∏ß‡∏≤‡∏î‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏ß‡πâ‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡πà‡∏ô‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏µ‡∏•‡∏á‡πÑ‡∏õ‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
        ctx.drawImage(colorCanvas, 0, 0);
    
        // 3. ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ Template (‡∏•‡∏≤‡∏¢‡πÄ‡∏™‡πâ‡∏ô) ‡∏ó‡∏±‡∏ö‡∏•‡∏á‡πÑ‡∏õ
        layers.forEach(layer => {
            ctx.drawImage(layer.img, 0, 0, canvas.width, canvas.height);
        });

        updateLayerListUI();
        saveHistory();
    }

    function updateLayerListUI() {
        const list = document.getElementById('layerList');
        list.innerHTML = '';
        [...layers].reverse().forEach((layer, index) => {
            const realIndex = layers.length - 1 - index;
            const item = document.createElement('div');
            item.className = 'layer-item';
            item.innerHTML = `
                <span>${layer.visible ? 'üëÅÔ∏è' : 'üö´'} ${layer.name}</span>
                <div class="layer-controls">
                    <button onclick="moveLayer(${realIndex}, 1)">Up</button>
                    <button onclick="moveLayer(${realIndex}, -1)">Down</button>
                    <button style="color:red" onclick="removeLayer(${realIndex})">Del</button>
                </div>

            `;
            list.appendChild(item);
        });
    }

        function moveLayer(index, direction) {
        const newIndex = index + direction;
        if (newIndex >= 0 && newIndex < layers.length) {
            const temp = layers[index];
            layers[index] = layers[newIndex];
            layers[newIndex] = temp;
            
            // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ç‡∏¢‡∏±‡∏ö‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå ‡∏ï‡πâ‡∏≠‡∏á Clear ‡∏™‡∏µ‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà (‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏µ‡πÑ‡∏ß‡πâ)
            // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ ‡∏à‡∏∞‡∏ß‡∏≤‡∏î‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            offCtx.clearRect(0, 0, offCanvas.width, offCanvas.height);
            redrawAllLayers();
        }
    }

    function removeLayer(index) {
        layers.splice(index, 1);
        if (layers.length === 0) { 
            canvas.width = 0; canvas.height = 0; 
            offCanvas.width = 0; offCanvas.height = 0;
        }
        offCtx.clearRect(0, 0, offCanvas.width, offCanvas.height);
        redrawAllLayers();
    }
    
    function addPreset(name, url) {
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.onload = () => addLayer(img, name);
        img.onerror = () => alert("Image load failed. Check GitHub path.");
        img.src = url + "?t=" + new Date().getTime();
    }

    function saveImage() {
        const tempCanvas = document.createElement('canvas');
        // ‡πÉ‡∏ä‡πâ‡∏Ç‡∏ô‡∏≤‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á Canvas ‡∏´‡∏•‡∏±‡∏Å (High Res)
        tempCanvas.width = canvas.width;
        tempCanvas.height = canvas.height;
        const tCtx = tempCanvas.getContext('2d');
        
        // 1. ‡∏ß‡∏≤‡∏î‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏•‡∏á‡πÉ‡∏ô Canvas ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
        tCtx.drawImage(canvas, 0, 0);
        
        // 2. ‡πÇ‡∏´‡∏•‡∏î‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥
        const wm = new Image();
        wm.crossOrigin = "Anonymous";
        wm.src = watermarkUrl + "?t=" + new Date().getTime();
        
        wm.onload = () => {
            // --- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á (Dynamic Scaling) ---
            // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏Å‡∏ß‡πâ‡∏≤‡∏á 25% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
            const wmWidth = tempCanvas.width * 0.25; 
            const wmHeight = (wm.height / wm.width) * wmWidth;
            
            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏á (0.5 ‡∏Ñ‡∏∑‡∏≠ 50%)
            tCtx.globalAlpha = 0.5; 
            
            // --- ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á (‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á) ---
            // ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö 3% ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏£‡∏π‡∏õ
            const margin = tempCanvas.width * 0.03; 
            const posX = tempCanvas.width - wmWidth - margin;
            const posY = tempCanvas.height - wmHeight - margin;
            
            tCtx.drawImage(wm, posX, posY, wmWidth, wmHeight);
            
            // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡∏Å‡πà‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
            tCtx.globalAlpha = 1.0; 
            
            // 3. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
            const link = document.createElement('a');
            link.download = (document.getElementById('fileName').value || "Design") + '.png';
            link.href = tempCanvas.toDataURL("image/png");
            link.click();
        };

        wm.onerror = () => {
            alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏•‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Check path: watermark.png) ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏†‡∏≤‡∏û‡∏õ‡∏Å‡∏ï‡∏¥‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏±‡∏ö");
            const link = document.createElement('a');
            link.download = (document.getElementById('fileName').value || "Design") + '.png';
            link.href = tempCanvas.toDataURL("image/png");
            link.click();
        };
    }

        function centerContent() { 
            const area = document.getElementById('scrollArea'); 
            area.scrollLeft = (area.scrollWidth - area.clientWidth)/2; 
            area.scrollTop = (area.scrollHeight - area.clientHeight)/2; 
            }
    canvas.addEventListener('mousedown', e => handleAction(e));
    canvas.addEventListener('touchstart', e => { if(!isMoveMode) { handleAction(e.touches[0]); e.preventDefault(); } });

    // --- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡πÇ‡∏î‡∏¢‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤ Zoom ---
    function handleAction(e) {
        if (canvas.width === 0 || isMoveMode) return;
        const rect = canvas.getBoundingClientRect();
        // ‡∏™‡∏π‡∏ï‡∏£‡πÉ‡∏´‡∏°‡πà: ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏¥‡πâ‡∏°‡∏ö‡∏ô‡∏à‡∏≠ / ‡∏Ñ‡πà‡∏≤‡∏ã‡∏π‡∏°‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô = ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏£‡∏¥‡∏á‡∏ö‡∏ô‡∏†‡∏≤‡∏û High-Res
        const x = Math.floor((e.clientX - rect.left) / currentZoom);
        const y = Math.floor((e.clientY - rect.top) / currentZoom);

        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏¥‡πâ‡∏°‡∏ô‡∏≠‡∏Å‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï
        if (x < 0 || x >= canvas.width || y < 0 || y >= canvas.height) return;

        const targetColor = ctx.getImageData(x, y, 1, 1).data;
        const fillRGB = hexToRgb(document.getElementById('colorPicker').value);
        if (targetColor[0] < 80 && targetColor[1] < 80 && targetColor[2] < 80) return;
        saveHistory();
        floodFill(x, y, fillRGB, targetColor);
    }

    function floodFill(startX, startY, fillColor) {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        const targetColor = getPixel(startX, startY, data);
        if (colorsMatch(targetColor, [fillColor.r, fillColor.g, fillColor.b, 255])) return;
        
        const stack = [[startX, startY]];
        while (stack.length > 0) {
            const [x, y] = stack.pop();
            const currentColor = getPixel(x, y, data);
            if (colorsMatch(currentColor, targetColor)) {
                setPixel(x, y, fillColor, data);
                if (x > 0) stack.push([x - 1, y]);
                if (x < canvas.width - 1) stack.push([x + 1, y]);
                if (y > 0) stack.push([x, y - 1]);
                if (y < canvas.height - 1) stack.push([x, y + 1]);
            }
        }
        ctx.putImageData(imageData, 0, 0);
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Hidden Canvas ‡∏î‡πâ‡∏ß‡∏¢‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏•‡∏™‡∏µ‡πÉ‡∏´‡∏°‡πà
        offCtx.putImageData(imageData, 0, 0);
    }

    // ‡πÅ‡∏Å‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏™‡∏£‡∏¥‡∏°‡πÉ‡∏´‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• data ‡∏ï‡∏£‡∏á‡πÜ
    function getPixel(x, y, data) { 
        const i = (y * canvas.width + x) * 4; 
        return [data[i], data[i+1], data[i+2], data[i+3]]; 
}

    function hexToRgb(h) { 
        const r = parseInt(h.slice(1,3),16), g=parseInt(h.slice(3,5),16), b=parseInt(h.slice(5,7),16); 
        return {r,g,b}; }

    function resetAll() { if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) { localStorage.removeItem('nuchDesign_backup'); location.reload(); } }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏™‡∏µ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (Missing Function)
    function colorsMatch(c1, c2) {
        return Math.abs(c1[0] - c2[0]) < 40 && 
               Math.abs(c1[1] - c2[1]) < 40 && 
               Math.abs(c1[2] - c2[2]) < 40;
}

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏™‡∏µ‡∏•‡∏á‡∏û‡∏¥‡∏Å‡πÄ‡∏ã‡∏• (Missing Function)
    function setPixel(x, y, color, data) {
        const i = (y * canvas.width + x) * 4;
        data[i] = color.r;
        data[i+1] = color.g;
        data[i+2] = color.b;
        data[i+3] = 255; // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏∂‡∏ö 100%
}

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î ‡πÄ‡∏°‡∏ô‡∏π‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢
    function toggleFAB() {
        const fab = document.getElementById('fabContainer');
        fab.classList.toggle('active');
    }

    // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô toggleMoveMode ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏î‡πâ‡∏ß‡∏¢
    // ‡πÉ‡∏´‡πâ‡∏´‡∏≤‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô toggleMoveMode ‡πÄ‡∏î‡∏¥‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏û‡∏¥‡πà‡∏° 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏Ñ‡∏£‡∏±‡∏ö
    const originalToggleMoveMode = toggleMoveMode;
    toggleMoveMode = function() {
        originalToggleMoveMode(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°
        const fabBtn = document.getElementById('fabMoveBtn');
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ö‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏≠‡∏¢
        if(isMoveMode) {
            fabBtn.innerText = "üëÜüîÑ";
            fabBtn.style.background = "#e67e22";
            fabBtn.style.color = "white";
        } else {
            fabBtn.innerText = "üñåÔ∏èüîÑ";
            fabBtn.style.background = "#f1c40f";
            fabBtn.style.color = "#333";
        }
    };

</script>

<div class="fab-container" id="fabContainer">
        <button class="fab-main" onclick="toggleFAB()">+</button>
        
        <div class="fab-menu">
        
            <button id="fabMoveBtn" class="fab-item fab-item-paint" onclick="toggleMoveMode(); toggleFAB();">üñåÔ∏èüîÑ</button>
            
            <button class="fab-item fab-item-palette" onclick="toggleSidebar('colors'); toggleFAB();">üé®</button>

            <button class="fab-item fab-item-template" onclick="toggleSidebar('presets'); toggleFAB();">üñºÔ∏è</button>
            
            <button class="fab-item fab-item-layer" onclick="toggleSidebar('layers'); toggleFAB();">üìë</button>
            
            <button class="fab-item fab-item-undo" onclick="undo(); toggleFAB();">üîô</button>

            <button class="fab-item fab-item-save" onclick="saveImage(); toggleFAB();">‚úÖ</button>

            <button class="fab-item fab-item-reset" onclick="resetAll(); toggleFAB();">‚ùå</button>
            

        </div>
    </div>

</body>
</html>
